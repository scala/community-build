// https://github.com/scalacenter/scalafix.git#main

vars.proj.scalafix: ${vars.base} {
  name: "scalafix"
  uri: "https://github.com/scalacenter/scalafix.git#46b8dfe75c8b9fddd0df75fb55ce9655753a7d07"

  // as per https://github.com/scalacenter/scalafix/issues/1699 we don't
  // include "*2_13" because we can't build many subprojects, including most test
  // subprojects, because they use sun.misc.Unsafe which is JDK 8 only;
  // in particular, it's a shame we had to drop scalafix-testkit, which is
  // used by about a half dozen repos downstream (grep for it)
  extra.projects: ["interfaces", "core2_13", "rules2_13"]
  extra.commands: ${vars.default-commands} [
    // these tests fail because they're fetching dbuild-built dependencies
    // (Scalameta and Scalafix itself) at runtime. I didn't dig into it.
    // CliGitDiffSuite is something else I didn't investigate either.
    """set unit.allProjects.map(_._1).find(_.id == "unit2_13Target2_13").get / unmanagedSources / excludeFilter := HiddenFileFilter || "ScalafixImplSuite.scala" || "ScalafixSuite.scala" || "ScalafixArgumentsSuite.scala" || "CliGitDiffSuite.scala""""
  ]
}
