// https://github.com/scalacommunitybuild/scalafix.git#community-build-2.13  # was scalacenter, main

// forked (June 2023) to adjust the Scala version to be configurable
// via `-Dscala.nightly=...`

vars.proj.scalafix: ${vars.base} {
  name: "scalafix"
  uri: "https://github.com/scalacommunitybuild/scalafix.git#df9636ff0df76752bdf486a39d234e7c98c1f13d"

  extra.options: ["-Dscala.nightly="${vars.scala-version}]
  extra.projects: ["*2_13"]
  extra.exclude: ["docs2_13"]
  extra.commands: ${vars.default-commands} [
    "removeScalacOptions -release 8"
    // CliGitDiffSuite: CommandLineError=4 did not equal Ok=0 error: 'master' unknown revision or path not in the working tree.
    """set unit.allProjects.map(_._1).find(_.id == "unit2_13").get / unmanagedSources / excludeFilter := HiddenFileFilter || "CliGitDiffSuite.scala""""
    // fails because they're fetching dbuild-built dependencies
    // (Scalameta and Scalafix itself) at runtime. I didn't dig into it.
    """set integration.allProjects.map(_._1).find(_.id == "integration2_13").get / unmanagedSources / excludeFilter := HiddenFileFilter || "ScalafixSuite.scala" || "ScalafixImplSuite.scala" || "ScalafixArgumentsSuite.scala""""
  ]
}
