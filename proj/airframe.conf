// https://github.com/wvlet/airframe.git#master

vars.proj.airframe: ${vars.base} {
  name: "airframe"
  uri: "https://github.com/wvlet/airframe.git#dc331483fe07cb6e8e40330a92c4aa6ef786f92d"

  check-missing: false  // ignore missing scripted-plugin
  extra.projects: ["communityBuild"]  // no Scala.js plz
  extra.options: [
    // without this, on JDK 16 wvlet.airframe.canvas.CanvasTest fails with
    // java.lang.reflect.InaccessibleObjectException: Unable to make private java.nio.DirectByteBuffer(long,int) accessible: module java.base does not "opens java.nio" to unnamed module @2b835af9
    "--illegal-access=permit"
    // and without this, we can't even extract on JDK 8
    "-XX:+IgnoreUnrecognizedVMOptions"
  ]
  extra.commands: ${vars.default-commands} [
    // on JDK 16, this fails so hard it takes dbuild down with it. not investigated
    """set controlJVM / Test / unmanagedSources / excludeFilter := HiddenFileFilter || "ShellTest.scala""""
    // just compile the tests in the ulid subproject, don't run them; see
    // https://github.com/scala/community-build/pull/1425 (June 2021)
    "set ulidJVM / Test / executeTests := Tests.Output(TestResult.Passed, Map(), Iterable())"
  ]
}
