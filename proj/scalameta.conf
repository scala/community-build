// https://github.com/scalacommunitybuild/scalameta.git#community-build-2.13  # was scalameta, v4.4.10

// we typically use a tag here rather than track a branch, in the
// interest of stability.  whatever tag scalafmt and/or scalafix expect

// forked (March 2021) from v4.4.10 tag to add 2.13.6 support;
// presumably we will able to unfork after 2.13.6 is released

vars.proj.scalameta: ${vars.base} {
  name: "scalameta"
  uri: "https://github.com/scalacommunitybuild/scalameta.git#f929a701d34bf4b4eeac15ef75e59c454cf27e93"

  extra.projects: ["semanticdbScalacPlugin", "testkit"]
  extra.commands: ${vars.default-commands} [
    // use right version-specific source directories regardless of our weird dbuild Scala version numbers
    """set common.jvm / Compile / unmanagedSourceDirectories += baseDirectory.value / "scalameta" / "common" / "shared" / "src" / "main" / "scala-2.13""""
    """set semanticdbScalacCore / Compile / unmanagedSourceDirectories += baseDirectory.value / "semanticdb" / "scalac" / "library" / "src" / "main" / "scala-2.13""""
    """set semanticdbScalacCore / Compile / unmanagedSourceDirectories += baseDirectory.value / "semanticdb" / "scalac" / "library" / "src" / "main" / "scala-2.13.6""""
    // reported upstream at https://github.com/scalameta/scalameta/issues/2246
    """set testkit / Test / unmanagedSources / excludeFilter := HiddenFileFilter || "TraverserOrder.scala""""
  ]
}
