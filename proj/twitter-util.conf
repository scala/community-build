// https://github.com/twitter/util.git#develop

vars.proj.twitter-util: ${vars.base} {
  name: "twitter-util"
  uri: "https://github.com/twitter/util.git#ef6e3fbd79e703865f533020a42973eb5e4be70e"

  extra.exclude: [
    // this isn't really necessary and would pull in a JMH dependency
    "util-benchmark"
    // test failures, not investigated
    "util-validator"
  ]
  extra.options: [
    // recommended at https://github.com/twitter/util/issues/173:
    // "We use that when we don't think the tests will be reliable in a ci environment"
    "-DSKIP_FLAKY=true"
  ]
  extra.commands: ${vars.default-commands} [
    // JDK 11+: failing test; not investigated or reported upstream. OutOfMemoryError
    """set utilCore / Test / unmanagedSources / excludeFilter := HiddenFileFilter || "FutureTest.scala""""
    // JDK 11+: failing tests, not investigated or reported upstream
    """set utilApp / Test / unmanagedSources / excludeFilter := HiddenFileFilter || "GlobalFlagTest.scala" || "JavaGlobalFlagTest.java" || "FlagsTest.scala" || "FlagTest.scala""""
    // 2.13: failing test; not investigated or reported upstream. it seems to be a GC-based test, those are typically fragile
    """set utilStats / Test / unmanagedSources / excludeFilter := HiddenFileFilter || "CumulativeGaugeTest.scala""""
    // not investigated
    """set utilJackson / Test / unmanagedSources / excludeFilter := HiddenFileFilter || "ScalaObjectMapperTest.scala""""
    // not supported on JDK 11+
    "removeJavaOptions -XX:+UseParNewGC"
  ]
}
